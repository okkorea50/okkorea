import { db } from './firebase.js';
import { collection, addDoc, getDocs, deleteDoc, doc } from 'firebase/firestore';

const rawJobs = [
    "5. [í¬ì²œ] ì² íŒì ˆê³¡ ë° ë²¤ë”© (E-9) / 240ë§Œ / 1ëª…",
    "8. [í¬ì²œ] ìŒë£Œìƒì‚° (E-9) / ê¸°ìˆ™ì‚¬ ë¬´ / 230ë§Œ / 1ëª…",
    "10. [í¬ì²œ] ë°˜ì°¬/ì¥ì‹ êµ¬(ìˆ˜ì—¼X) (E-9) / ê¸°ìˆ™ì‚¬ ë¬´ / ë‚¨ 230, ì—¬ 220 / 6ëª…",
    "12. [í¬ì²œ] í•œì‹ë°˜ì°¬/ë°€í‚¤íŠ¸ (E-9) / ê¸°ìˆ™ì‚¬ ë¬´ / ë‚¨ 230, ì—¬ 220 / 6ëª… (ë¼ì§€ê³ ê¸° ì·¨ê¸‰)",
    "13. [ê°•í™”] í™”ì¥í’ˆ ì›ë£Œìƒì‚° (E-7-4R) / ê¸°ìˆ™ì‚¬ ìœ  / 300ë§Œ / 4ëª…",
    "14. [ê°•í™”] ê¸°ê³„ë¶€í’ˆì œì¡° (E-7-4R) / ê¸°ìˆ™ì‚¬ ë¬´ / 300ë§Œ / 1ëª…",
    "16. [í¬ì²œ] ê°€êµ¬ê³µì¥(ê²½ë ¥ì) (E-7-4R) / ê¸°ìˆ™ì‚¬ ìœ  / 220ë§Œ(ê¸°ìˆ™ì‚¬ë¹„ ê³µì œ)",
    "17. [ì‹œí¥] ì•Œë¯¸ëŠ„ì½”íŒ… (E-9) / ê¸°ìˆ™ì‚¬ ìœ (ìœ ë£Œ) / êµëŒ€ 339ë§Œ / ì£¼ê°„ 240ë§Œ",
    "63. [ìŒì„±] ê¹€ì¹˜ì œì¡° (E-9) / ê¸°ìˆ™ì‚¬ ìœ  / 250-280ë§Œ / ë‚¨2, ì—¬1",
    "65. [ìŒì„±] ì›ë£Œì¬ìƒ ì‡¼íŠ¸ì„¤ë¹„ (E-9) / ê¸°ìˆ™ì‚¬ ìœ  / 270-300ë§Œ / 1ëª… (íŒŒí‚¤ìŠ¤íƒ„ ì œì™¸)",
    "66. [í™ì„±] ì–‘ê³„ì¥ ë‹­ì‚¬ìœ¡ (E-9) / ê¸°ìˆ™ì‚¬ ìœ  / 260ë§Œ / 5ëª…",
    "68. [ìŒì„±] í†±ë°¥ê¸°ê³„/í¬í¬ë ˆì¸ (E-9) / ê¸°ìˆ™ì‚¬ ìœ  / 300ë§Œ(6ê°œì›” í›„ 330) / 1ëª…",
    "70. [ìŒì„±] ì•µê¸€ CNC ê²½ë ¥ì (E-9) / ê¸°ìˆ™ì‚¬ ìœ  / 350-430ë§Œ / 1ëª…",
    "71. [ì¶©ì£¼] ê¹€ ê°€ê³µ (E-9) / ê¸°ìˆ™ì‚¬ ë¬´ / 250ë§Œ(ì£¼ 4ì¼) / 2ëª…",
    "101. [ë‹´ì–‘] ABSë„ì–´ ì œì‘ (E-7-4R) / ê¸°ìˆ™ì‚¬ ìœ  / 230-300ë§Œ / 2ëª… (êµ­ì ë¬´ê´€)",
    "105. [ì˜ì•”] ì„ ë°•ê°€ê³µ(ë¸”ëŸ­) (E-7-4R) / ê¸°ìˆ™ì‚¬ ë¬´ / ì¼ 11ë§Œ / 2ëª…",
    "107. [ê¹€ì œ] íŠ¹ì¥ì°¨ ì¡°ë¦½ (E-7-4R) / ê¸°ìˆ™ì‚¬ ìœ  / 250-300ë§Œ",
    "108. [ê´‘ì£¼] ì‚°ì†Œ/CO2 ìš©ì ‘ (E-9) / ê¸°ìˆ™ì‚¬ ìœ  / 300ë§Œ",
    "163. [ì˜ì²œ] ìë™ì°¨ ë¶€í’ˆìƒì‚° (E-9) / ê¸°ìˆ™ì‚¬ ë¬´ / 340ë§Œ / 2ëª… (í•œêµ­ì–´ ê°€ëŠ¥ì)",
    "165. [ê²½ì£¼] ì œì„¤ì œ ìƒì‚° (E-9) / ê¸°ìˆ™ì‚¬ ë¬´ / 250ë§Œ / 2ëª…",
    "167. [í™ì²œ] ìœ¡ê°€ê³µ(ë¼ì§€) (E-7-4R) / ê¸°ìˆ™ì‚¬ ë¬´ / 216-350ë§Œ / 2ëª…",
    "202. [ì‚°ì²­] ê³¼ì¼ì ¤ë¦¬ìƒì‚° (E-7-4R) / ê¸°ìˆ™ì‚¬ ìœ  / 280-300ë§Œ / ì—¬ì 2ëª… (êµ­ì ë¬´ê´€)",
    "204. [ê³ ë ¹] CO2ìš©ì ‘/íŒŒë ›íŠ¸ (E-7-4R) / ê¸°ìˆ™ì‚¬ ìœ  / 230ë§Œ(6ê°œì›” í›„ 300) / 2ëª…",
    "206, 210. [ë¶€ì‚°] ìˆ˜ì‚°ë¬¼í¬ì¥ (E-9) / ê¸°ìˆ™ì‚¬ ë¬´ / 216ë§Œ",
    "207. [í•¨ì•ˆ] ëª©ì¬ í¬ì¥ (E-7-4R) / ê¸°ìˆ™ì‚¬ ë¬´ / 280ë§Œ / 1ëª…",
    "209. [í•¨ì–‘] ì œí’ˆ ì œì¡° ë° í¬ì¥ (E-7-4R) / ê¸°ìˆ™ì‚¬ ë¬´ / 260-270ë§Œ / 2ëª…",
    "213. [ì‚°ì²­] ì ¤ë¦¬ìƒì‚° (E-7-4R) / ê¸°ìˆ™ì‚¬ ìœ  / 250-300ë§Œ / ì—¬ì 2ëª…",
    "214. [ê±°ì°½] ì¸ì¡°ëŒ€ë¦¬ì„ìƒì‚° (E-7-4R) / ê¸°ìˆ™ì‚¬ ë¬´ / 216ë§Œ / 1ëª…",
    "216. [ê³ ì„±] ì¡°ì„  ë¶€ìì¬ìƒì‚° (E-7-4R) / ê¸°ìˆ™ì‚¬ ìœ  / 260-270ë§Œ"
];

const jobs = rawJobs.map((line, index) => {
    // Robust salary extraction: look for patterns like 240ë§Œ, 250-280ë§Œ, ì¼ 11ë§Œ
    const salaryMatch = line.match(/([\d\-,~\s]+ë§Œ|ì¼\s*\d+ë§Œ)/);
    const salary = salaryMatch ? salaryMatch[0] : "í˜‘ì˜";

    const parts = line.split(' / ');
    const titlePart = parts[0].split('] ');
    const location = titlePart[0].replace(/.*\[/, '');
    const title = titlePart[1]?.replace(/\s*\(.*\)/, '') || titlePart[0];
    const visa = line.match(/\((E-.*?)\)/)?.[1] || 'E-9';

    // Extract tags from the raw string
    const tags = [];
    if (line.includes('ê¸°ìˆ™ì‚¬ ë¬´')) tags.push('ê¸°ìˆ™ì‚¬âŒ');
    else if (line.includes('ê¸°ìˆ™ì‚¬ ìœ ')) tags.push('ê¸°ìˆ™ì‚¬ğŸ ');
    if (line.includes('ê²½ë ¥ì')) tags.push('ê²½ë ¥ììš°ëŒ€');
    if (line.includes('í•œêµ­ì–´ ê°€ëŠ¥')) tags.push('í•œêµ­ì–´ğŸ—£ï¸');

    return {
        title: title.trim(),
        company: "í™•ì¸ í•„ìš”",
        location: location.trim(),
        visa: visa,
        salary: salary.trim(),
        raw: line,
        tags: tags,
        date: new Date(Date.now() - index * 60000).toISOString()
    };
});

async function clearAndSeed() {
    try {
        const jobsCol = collection(db, 'jobs');
        const snapshot = await getDocs(jobsCol);

        console.log("ğŸ§¹ Clearing old jobs...");
        for (const oldDoc of snapshot.docs) {
            await deleteDoc(doc(db, 'jobs', oldDoc.id));
        }

        console.log(`ğŸ“¡ Seeding ${jobs.length} new jobs...`);
        for (const job of jobs) {
            await addDoc(jobsCol, job);
            console.log(`   âœ… Added: ${job.title}`);
        }
        console.log("\nâœ¨ Seeding completed successfully!");
    } catch (e) {
        console.error("âŒ Seeding failed: ", e);
    }
}

clearAndSeed();
